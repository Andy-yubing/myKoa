<%- include("header",{type:'signup'}) %>
<div class="container">
	<form class="form create" action="/signup"  method="post">
		<div>
			<label>用户名：</label> 
			<input placeholder="用户名" type="text" name="name">
		</div>
		<div>
			<label>密码：</label> 
			<input class="password" type="password" name="password">
		</div>
		<div>
			<label>重复密码：</label> 
			<input class="repeatpass" type="password" name="repeatpass">
		</div>
		<div>
			<label>上传头像：</label>
			<input type="file" name="avator" id="avator">
			<input type="hidden" id="avatorVal">
			<img class="preview" alt="预览头像">
		</div>
		<div class="submit">注册</div>
		<!-- <input type="submit" value="注册"> -->
	</form>
</div>
<% include footer %>

<script>
	$('#avator').change(function(){
		console.log(this.files)
		
		
		if(this.files.length!=0){
			var file = this.files[0] , fileReader = new FileReader();
			console.log(fileReader)
			if(!fileReader){
				this.value = '';
				return;
			}

		}
	})

	$(".submit").click(()=>{
		if ($('input[name=name]').val().trim() == '') {
			$('.error').text('请输入用户名')
			fade('.error')
		}else if ($('input[name=name]').val().match(/[<'">]/g)) {
			$('.error').text('请输入合法字符')
			fade('.error')
		}else{
			console.log($(".form").serialize());
			$.ajax({
				url: "/signup",
				data: $(".form").serialize(),
				type: "post",
				cache: false,
				dataType: 'json',
				success: function(msg){
					console.log(msg);
					if(msg.data == 1){
						alert("用户名已存在")
					}else if(msg.data == 2){
						alert("输入有误")
					}else{
						 alert('注册成功');
						 setTimeout(()=>{
							window.location.href="/signin"
						 },1000)
					}
				},
				error:function(err){
					console.log(err);
				}
			})
		}
	})
</script>